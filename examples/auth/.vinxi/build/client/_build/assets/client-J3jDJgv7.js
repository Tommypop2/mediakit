const Wt=(t,e)=>t===e,B={equals:Wt};let Tt=Ot;const L=1,G=2,It={owned:null,cleanups:null,context:null,owner:null};var y=null;let ut=null,qt=null,_=null,E=null,k=null,H=0;function zt(t,e){e=e?Object.assign({},B,e):B;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),kt(n,s));return[Ut.bind(n),r]}function Zt(t,e,n){const r=dt(t,e,!1,L);q(r)}function Bt(t,e,n){Tt=Ht;const r=dt(t,e,!1,L);r.user=!0,k?k.push(r):q(r)}function yt(t,e,n){n=n?Object.assign({},B,n):B;const r=dt(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,q(r),Ut.bind(r)}function tt(t){if(_===null)return t();const e=_;_=null;try{return t()}finally{_=e}}function Gt(t){Bt(()=>tt(t))}function Xt(t,e){const n=Symbol("context");return{id:n,Provider:ee(n),defaultValue:t}}function Jt(t){let e;return y&&y.context&&(e=y.context[t.id])!==void 0?e:t.defaultValue}function Yt(t){const e=yt(t),n=yt(()=>ft(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function Ut(){if(this.sources&&this.state)if(this.state===L)q(this);else{const t=E;E=null,et(()=>J(this)),E=t}if(_){const t=this.observers?this.observers.length:0;_.sources?(_.sources.push(this),_.sourceSlots.push(t)):(_.sources=[this],_.sourceSlots=[t]),this.observers?(this.observers.push(_),this.observerSlots.push(_.sources.length-1)):(this.observers=[_],this.observerSlots=[_.sources.length-1])}return this.value}function kt(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&et(()=>{for(let s=0;s<t.observers.length;s+=1){const a=t.observers[s],o=ut&&ut.running;o&&ut.disposed.has(a),(o?!a.tState:!a.state)&&(a.pure?E.push(a):k.push(a),a.observers&&Pt(a)),o||(a.state=L)}if(E.length>1e6)throw E=[],new Error})),e}function q(t){if(!t.fn)return;ht(t);const e=H;Kt(t,t.value,e)}function Kt(t,e,n){let r;const s=y,a=_;_=y=t;try{r=t.fn(e)}catch(o){return t.pure&&(t.state=L,t.owned&&t.owned.forEach(ht),t.owned=null),t.updatedAt=n+1,Lt(o)}finally{_=a,y=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?kt(t,r):t.value=r,t.updatedAt=n)}function dt(t,e,n,r=L,s){const a={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:y,context:y?y.context:null,pure:n};return y===null||y!==It&&(y.owned?y.owned.push(a):y.owned=[a]),a}function X(t){if(t.state===0)return;if(t.state===G)return J(t);if(t.suspense&&tt(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<H);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===L)q(t);else if(t.state===G){const r=E;E=null,et(()=>J(t,e[0])),E=r}}function et(t,e){if(E)return t();let n=!1;E=[],k?n=!0:k=[],H++;try{const r=t();return Qt(n),r}catch(r){n||(k=null),E=null,Lt(r)}}function Qt(t){if(E&&(Ot(E),E=null),t)return;const e=k;k=null,e.length&&et(()=>Tt(e))}function Ot(t){for(let e=0;e<t.length;e++)X(t[e])}function Ht(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:X(r)}for(e=0;e<n;e++)X(t[e])}function J(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const s=r.state;s===L?r!==e&&(!r.updatedAt||r.updatedAt<H)&&X(r):s===G&&J(r,e)}}}function Pt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=G,n.pure?E.push(n):k.push(n),n.observers&&Pt(n))}}function ht(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const a=s.pop(),o=n.observerSlots.pop();r<s.length&&(a.sourceSlots[o]=r,s[r]=a,n.observerSlots[r]=o)}}if(t.owned){for(e=t.owned.length-1;e>=0;e--)ht(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function te(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Lt(t,e=y){throw te(t)}function ft(t){if(typeof t=="function"&&!t.length)return ft(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=ft(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function ee(t,e){return function(r){let s;return Zt(()=>s=tt(()=>(y.context={...y.context,[t]:r.value},Yt(()=>r.children))),void 0),s}}function ne(t,e){return tt(()=>t(e||{}))}const re=()=>{};class p extends Error{constructor(e,n){e instanceof Error?super(void 0,{cause:{err:e,...e.cause,...n}}):typeof e=="string"?(n instanceof Error&&(n={err:n,...n.cause}),super(e,n)):super(void 0,e),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",Error.captureStackTrace?.(this,this.constructor);const r=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${r}`}}class R extends p{}R.kind="signIn";class se extends p{}se.type="AdapterError";class oe extends p{}oe.type="AccessDenied";class ie extends p{}ie.type="CallbackRouteError";class ae extends p{}ae.type="ErrorPageLoop";class le extends p{}le.type="EventError";class ue extends p{}ue.type="InvalidCallbackUrl";class ce extends R{constructor(){super(...arguments),this.code="credentials"}}ce.type="CredentialsSignin";class fe extends p{}fe.type="InvalidEndpoints";class pe extends p{}pe.type="InvalidCheck";class de extends p{}de.type="JWTSessionError";class he extends p{}he.type="MissingAdapter";class ve extends p{}ve.type="MissingAdapterMethods";class ge extends p{}ge.type="MissingAuthorize";class _e extends p{}_e.type="MissingSecret";class ye extends R{}ye.type="OAuthAccountNotLinked";class we extends R{}we.type="OAuthCallbackError";class Ee extends p{}Ee.type="OAuthProfileParseError";class Se extends p{}Se.type="SessionTokenError";class be extends R{}be.type="OAuthSignInError";class Ae extends R{}Ae.type="EmailSignInError";class me extends p{}me.type="SignOutError";class xe extends p{}xe.type="UnknownAction";class Ce extends p{}Ce.type="UnsupportedStrategy";class Te extends p{}Te.type="InvalidProvider";class Ue extends p{}Ue.type="UntrustedHost";class ke extends p{}ke.type="Verification";class Oe extends R{}Oe.type="MissingCSRF";class Pe extends p{}Pe.type="DuplicateConditionalUI";class Le extends p{}Le.type="MissingWebAuthnAutocomplete";class Re extends p{}Re.type="WebAuthnVerificationError";class $e extends R{}$e.type="AccountNotLinked";class je extends p{}je.type="ExperimentalFeatureNotEnabled";var v;function Rt(t){return t.children}v={__e:function(t,e,n,r){for(var s,a,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(t)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),o=s.__d),o)return s.__E=s}catch(g){t=g}throw t}};var De=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,$t=/^(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/,Y=/[\s\n\\/='"\0<>]/,jt=/^xlink:?./,Me=/["&<]/;function I(t){if(Me.test(t+="")===!1)return t;for(var e=0,n=0,r="",s="";n<t.length;n++){switch(t.charCodeAt(n)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;default:continue}n!==e&&(r+=t.slice(e,n)),r+=s,e=n+1}return n!==e&&(r+=t.slice(e,n)),r}var wt=function(t,e){return String(t).replace(/(\n+)/g,"$1"+(e||"	"))},Et=function(t,e,n){return String(t).length>40||String(t).indexOf(`
`)!==-1||String(t).indexOf("<")!==-1},St={},Ne=/([A-Z])/g;function Dt(t){var e="";for(var n in t){var r=t[n];r!=null&&r!==""&&(e&&(e+=" "),e+=n[0]=="-"?n:St[n]||(St[n]=n.replace(Ne,"-$1").toLowerCase()),e=typeof r=="number"&&De.test(n)===!1?e+": "+r+"px;":e+": "+r+";")}return e||void 0}function pt(t,e){return Array.isArray(e)?e.reduce(pt,t):e!=null&&e!==!1&&t.push(e),t}function bt(){this.__d=!0}function Mt(t,e){return{__v:t,context:e,props:t.props,setState:bt,forceUpdate:bt,__d:!0,__h:[]}}function K(t,e){var n=t.contextType,r=n&&e[n.__c];return n!=null?r?r.props.value:n.__:e}var ct=[];function W(t,e,n,r,s,a){if(t==null||typeof t=="boolean")return"";if(typeof t!="object")return I(t);var o=n.pretty,g=o&&typeof o=="string"?o:"	";if(Array.isArray(t)){for(var A="",C=0;C<t.length;C++)o&&C>0&&(A+=`
`),A+=W(t[C],e,n,r,s,a);return A}var $,f=t.type,S=t.props,w=!1;if(typeof f=="function"){if(w=!0,!n.shallow||!r&&n.renderRootComponent!==!1){if(f===Rt){var d=[];return pt(d,t.props.children),W(d,e,n,n.shallowHighOrder!==!1,s,a)}var h,l=t.__c=Mt(t,e);v.__b&&v.__b(t);var b=v.__r;if(f.prototype&&typeof f.prototype.render=="function"){var O=K(f,e);(l=t.__c=new f(S,O)).__v=t,l._dirty=l.__d=!0,l.props=S,l.state==null&&(l.state={}),l._nextState==null&&l.__s==null&&(l._nextState=l.__s=l.state),l.context=O,f.getDerivedStateFromProps?l.state=Object.assign({},l.state,f.getDerivedStateFromProps(l.props,l.state)):l.componentWillMount&&(l.componentWillMount(),l.state=l._nextState!==l.state?l._nextState:l.__s!==l.state?l.__s:l.state),b&&b(t),h=l.render(l.props,l.state,l.context)}else for(var N=K(f,e),F=0;l.__d&&F++<25;)l.__d=!1,b&&b(t),h=f.call(t.__c,S,N);return l.getChildContext&&(e=Object.assign({},e,l.getChildContext())),v.diffed&&v.diffed(t),W(h,e,n,n.shallowHighOrder!==!1,s,a)}f=($=f).displayName||$!==Function&&$.name||function(it){var at=(Function.prototype.toString.call(it).match(/^\s*function\s+([^( ]+)/)||"")[1];if(!at){for(var Z=-1,lt=ct.length;lt--;)if(ct[lt]===it){Z=lt;break}Z<0&&(Z=ct.push(it)-1),at="UnnamedComponent"+Z}return at}($)}var j,m,u="<"+f;if(S){var P=Object.keys(S);n&&n.sortAttributes===!0&&P.sort();for(var x=0;x<P.length;x++){var c=P[x],i=S[c];if(c!=="children"){if(!Y.test(c)&&(n&&n.allAttributes||c!=="key"&&c!=="ref"&&c!=="__self"&&c!=="__source")){if(c==="defaultValue")c="value";else if(c==="defaultChecked")c="checked";else if(c==="defaultSelected")c="selected";else if(c==="className"){if(S.class!==void 0)continue;c="class"}else s&&jt.test(c)&&(c=c.toLowerCase().replace(/^xlink:?/,"xlink:"));if(c==="htmlFor"){if(S.for)continue;c="for"}c==="style"&&i&&typeof i=="object"&&(i=Dt(i)),c[0]==="a"&&c[1]==="r"&&typeof i=="boolean"&&(i=String(i));var T=n.attributeHook&&n.attributeHook(c,i,e,n,w);if(T||T==="")u+=T;else if(c==="dangerouslySetInnerHTML")m=i&&i.__html;else if(f==="textarea"&&c==="value")j=i;else if((i||i===0||i==="")&&typeof i!="function"){if(!(i!==!0&&i!==""||(i=c,n&&n.xml))){u=u+" "+c;continue}if(c==="value"){if(f==="select"){a=i;continue}f==="option"&&a==i&&S.selected===void 0&&(u+=" selected")}u=u+" "+c+'="'+I(i)+'"'}}}else j=i}}if(o){var V=u.replace(/\n\s*/," ");V===u||~V.indexOf(`
`)?o&&~u.indexOf(`
`)&&(u+=`
`):u=V}if(u+=">",Y.test(f))throw new Error(f+" is not a valid HTML tag name in "+u);var z,Vt=$t.test(f)||n.voidElements&&n.voidElements.test(f),U=[];if(m)o&&Et(m)&&(m=`
`+g+wt(m,g)),u+=m;else if(j!=null&&pt(z=[],j).length){for(var nt=o&&~u.indexOf(`
`),gt=!1,rt=0;rt<z.length;rt++){var st=z[rt];if(st!=null&&st!==!1){var D=W(st,e,n,!0,f==="svg"||f!=="foreignObject"&&s,a);if(o&&!nt&&Et(D)&&(nt=!0),D)if(o){var _t=D.length>0&&D[0]!="<";gt&&_t?U[U.length-1]+=D:U.push(D),gt=_t}else U.push(D)}}if(o&&nt)for(var ot=U.length;ot--;)U[ot]=`
`+g+wt(U[ot],g)}if(U.length||m)u+=U.join("");else if(n&&n.xml)return u.substring(0,u.length-1)+" />";return!Vt||z||m?(o&&~u.indexOf(`
`)&&(u+=`
`),u=u+"</"+f+">"):u=u.replace(/>$/," />"),u}var Fe={shallow:!0};Q.render=Q;var Ve=function(t,e){return Q(t,e,Fe)},At=[];function Q(t,e,n){e=e||{};var r,s=v.__s;return v.__s=!0,r=n&&(n.pretty||n.voidElements||n.sortAttributes||n.shallow||n.allAttributes||n.xml||n.attributeHook)?W(t,e,n):M(t,e,!1,void 0),v.__c&&v.__c(t,At),v.__s=s,At.length=0,r}function We(t,e){return t==="className"?"class":t==="htmlFor"?"for":t==="defaultValue"?"value":t==="defaultChecked"?"checked":t==="defaultSelected"?"selected":e&&jt.test(t)?t.toLowerCase().replace(/^xlink:?/,"xlink:"):t}function Ie(t,e){return t==="style"&&e!=null&&typeof e=="object"?Dt(e):t[0]==="a"&&t[1]==="r"&&typeof e=="boolean"?String(e):e}var mt=Array.isArray,xt=Object.assign;function M(t,e,n,r){if(t==null||t===!0||t===!1||t==="")return"";if(typeof t!="object")return I(t);if(mt(t)){for(var s="",a=0;a<t.length;a++)s+=M(t[a],e,n,r);return s}v.__b&&v.__b(t);var o=t.type,g=t.props;if(typeof o=="function"){if(o===Rt)return M(t.props.children,e,n,r);var A;A=o.prototype&&typeof o.prototype.render=="function"?function(u,P){var x=u.type,c=K(x,P),i=new x(u.props,c);u.__c=i,i.__v=u,i.__d=!0,i.props=u.props,i.state==null&&(i.state={}),i.__s==null&&(i.__s=i.state),i.context=c,x.getDerivedStateFromProps?i.state=xt({},i.state,x.getDerivedStateFromProps(i.props,i.state)):i.componentWillMount&&(i.componentWillMount(),i.state=i.__s!==i.state?i.__s:i.state);var T=v.__r;return T&&T(u),i.render(i.props,i.state,i.context)}(t,e):function(u,P){var x,c=Mt(u,P),i=K(u.type,P);u.__c=c;for(var T=v.__r,V=0;c.__d&&V++<25;)c.__d=!1,T&&T(u),x=u.type.call(c,u.props,i);return x}(t,e);var C=t.__c;C.getChildContext&&(e=xt({},e,C.getChildContext()));var $=M(A,e,n,r);return v.diffed&&v.diffed(t),$}var f,S,w="<";if(w+=o,g)for(var d in f=g.children,g){var h=g[d];if(!(d==="key"||d==="ref"||d==="__self"||d==="__source"||d==="children"||d==="className"&&"class"in g||d==="htmlFor"&&"for"in g||Y.test(d))){if(h=Ie(d=We(d,n),h),d==="dangerouslySetInnerHTML")S=h&&h.__html;else if(o==="textarea"&&d==="value")f=h;else if((h||h===0||h==="")&&typeof h!="function"){if(h===!0||h===""){h=d,w=w+" "+d;continue}if(d==="value"){if(o==="select"){r=h;continue}o!=="option"||r!=h||"selected"in g||(w+=" selected")}w=w+" "+d+'="'+I(h)+'"'}}}var l=w;if(w+=">",Y.test(o))throw new Error(o+" is not a valid HTML tag name in "+w);var b="",O=!1;if(S)b+=S,O=!0;else if(typeof f=="string")b+=I(f),O=!0;else if(mt(f))for(var N=0;N<f.length;N++){var F=f[N];if(F!=null&&F!==!1){var j=M(F,e,o==="svg"||o!=="foreignObject"&&n,r);j&&(b+=j,O=!0)}}else if(f!=null&&f!==!1&&f!==!0){var m=M(f,e,o==="svg"||o!=="foreignObject"&&n,r);m&&(b+=m,O=!0)}if(v.diffed&&v.diffed(t),O)w+=b;else if($t.test(o))return l+" />";return w+"</"+o+">"}Q.shallowRender=Ve;var Ct={};function qe(t){const e=new URL("http://localhost:3000/api/auth");t&&!t.toString().startsWith("http")&&(t=`https://${t}`);const n=new URL(t??e),r=(n.pathname==="/"?e.pathname:n.pathname).replace(/\/$/,""),s=`${n.origin}${r}`;return{origin:n.origin,host:n.host,path:r,base:s,toString:()=>s}}const ze=t=>{if(t.startsWith("VITE_"))return{BASE_URL:"/_build",CWD:"/Users/or/Desktop/mediakit2/examples/auth",DEV:!1,DEVTOOLS:!1,MANIFEST:globalThis.MANIFEST,MODE:"production",PROD:!0,ROUTERS:["public","ssr","client","server-fns"],ROUTER_HANDLER:"src/entry-client.tsx",ROUTER_NAME:"client",ROUTER_TYPE:"client",SERVER_BASE_URL:"",SSR:!1,START_APP:"./src/app.tsx",START_DEV_OVERLAY:!0,START_ISLANDS:!1,START_SSR:!0,VITE_AUTH_PATH:"/api/auth"}[t];if(typeof process<"u"&&typeof Ct<"u"&&!t.startsWith("VITE_"))return Ct[t]},Nt=(...t)=>{for(const e of t){const n=ze(e);if(n)return n}},vt=t=>Nt("VITE_AUTH_PATH")??"/api/auth",Ft=Xt(void 0),Je=()=>{const t=Jt(Ft);if(!t)throw new Error("[@solid-mediakit/auth]: `useAuth` must be wrapped in a <SessionProvider />");return{signIn:async(r,s,a)=>await Ge(t.authAction,r,s,a),signOut:async r=>await Xe(t.authAction,r),status:()=>t.sessionState().status,session:()=>t.sessionState().data}};function Ye(t){const e=re(),[n,r]=zt({status:"loading",data:void 0}),s=async()=>{try{const o=await Be(e);return o?{status:"authenticated",data:o}:{status:"unauthenticated",data:null}}catch(o){return console.error("@auth",o),{status:"unauthenticated",data:null}}},a=async o=>{o&&n().status!=="loading"&&!t.refetchAfterServer||r(await s())};return Gt(()=>{a(!0)}),ne(Ft.Provider,{value:{sessionState:n,setSessionState:r,authAction:a},get children(){return t.children}})}const Ze=t=>typeof window>"u"?`${qe(Nt("AUTH_URL_INTERNAL","AUTH_URL","VERCEL_URL")).origin}${t}`:t,Be=async t=>{const n=await fetch(Ze(`${vt()}/session`),void 0),r=await n.json();if(!n.ok)throw new Error(r.error);return!r||Object.keys(r).length===0?null:r};async function Ge(t,e,n,r){const{callbackUrl:s=window.location.href,redirect:a=!0}=n??{},o=e==="credentials",A=o||e==="email",C=vt(),f=`${`${C}/${o?"callback":"signin"}/${e}`}?${new URLSearchParams(r)}`,S=await fetch(`${C}/csrf`),{csrfToken:w}=await S.json(),d=await fetch(f,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({...n,csrfToken:w,callbackUrl:s})}),h=await d.clone().json();if(a||!A){window.location.href=h.url??s,h.url.includes("#")&&window.location.reload();return}const l=new URL(h.url).searchParams.get("error"),b=new URL(h.url).searchParams.get("code");return d.ok&&await t(),{error:l,code:b,status:d.status,ok:d.ok,url:l?null:h.url}}async function Xe(t,e){const{redirectTo:n=window.location.href}=e??{},r=vt(),s=await fetch(`${r}/csrf`),{csrfToken:a}=await s.json(),g=await(await fetch(`${r}/signout`,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({csrfToken:a,callbackUrl:n})})).json();if(e?.redirect??!0){const A=g.url??n;window.location.href=A,A.includes("#")&&window.location.reload();return}return await t(),g}export{Ye as S,Je as u};
