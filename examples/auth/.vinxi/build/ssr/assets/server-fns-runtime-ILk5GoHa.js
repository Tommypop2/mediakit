import{getOwner as se,runWithOwner as oe,createMemo as S,createContext as ae,useContext as ie,createSignal as q,createRenderEffect as Ee,on as ce,startTransition as W,resetErrorBoundaries as Ce,batch as Pe,untrack as Se,createComponent as Ae,getListener as He,onCleanup as Oe,sharedConfig as C}from"solid-js";import{isServer as v,getRequestEvent as E}from"solid-js/web";import{provideRequestEvent as qe}from"solid-js/web/storage";import{H3Event as K,setResponseStatus as Te,sendRedirect as $e,setHeader as Le,getRequestIP as ke,getResponseStatus as _e,getResponseStatusText as Fe,getCookie as je,setCookie as Ie,getRequestURL as Ue,getResponseHeaders as We,getResponseHeader as Me,setResponseHeader as Be,appendResponseHeader as De,removeResponseHeader as Ne,getRequestWebStream as Ke}from"h3";import{d as ze}from"./auth-DgOjBUDV.js";import{AsyncLocalStorage as Ge}from"node:async_hooks";function Je(){let e=new Set;function t(s){return e.add(s),()=>e.delete(s)}let n=!1;function r(s,o){if(n)return!(n=!1);const a={to:s,options:o,defaultPrevented:!1,preventDefault:()=>a.defaultPrevented=!0};for(const f of e)f.listener({...a,from:f.location,retry:h=>{h&&(n=!0),f.navigate(s,{...o,resolve:!1})}});return!a.defaultPrevented}return{subscribe:t,confirm:r}}let z;function ue(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),z=window.history.state._depth}v||ue();function Bt(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function Dt(e,t){let n=!1;return()=>{const r=z;ue();const s=r==null?null:z-r;if(n){n=!1;return}s&&t(s)?(n=!0,window.history.go(-s)):e()}}const Xe=/^(?:[a-z0-9]+:)?\/\//i,Qe=/^\/+|(\/)\/+$/g,Ve="http://sr";function $(e,t=!1){const n=e.replace(Qe,"$1");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function M(e,t,n){if(Xe.test(t))return;const r=$(e),s=n&&$(n);let o="";return!s||t.startsWith("/")?o=r:s.toLowerCase().indexOf(r.toLowerCase())!==0?o=r+s:o=s,(o||"/")+$(t,!o)}function Ye(e,t){if(e==null)throw new Error(t);return e}function Ze(e,t){return $(e).replace(/\/*(\*.*)?$/g,"")+$(t)}function le(e){const t={};return e.searchParams.forEach((n,r)=>{t[r]=n}),t}function et(e,t,n){const[r,s]=e.split("/*",2),o=r.split("/").filter(Boolean),a=o.length;return f=>{const h=f.split("/").filter(Boolean),p=h.length-a;if(p<0||p>0&&s===void 0&&!t)return null;const c={path:a?"":"/",params:{}},i=m=>n===void 0?void 0:n[m];for(let m=0;m<a;m++){const l=o[m],y=l[0]===":",d=y?h[m]:h[m].toLowerCase(),R=y?l.slice(1):l.toLowerCase();if(y&&B(d,i(R)))c.params[R]=d;else if(y||!B(d,R))return null;c.path+=`/${d}`}if(s){const m=p?h.slice(-p).join("/"):"";if(B(m,i(s)))c.params[s]=m;else return null}return c}}function B(e,t){const n=r=>r===e;return t===void 0?!0:typeof t=="string"?n(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function tt(e){const[t,n]=e.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((s,o)=>s+(o.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function fe(e){const t=new Map,n=se();return new Proxy({},{get(r,s){return t.has(s)||oe(n,()=>t.set(s,S(()=>e()[s]))),t.get(s)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())}})}function he(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const s=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)s.push(n+=t[1]),r=r.slice(t[0].length);return he(r).reduce((o,a)=>[...o,...s.map(f=>f+a)],[])}const nt=100,rt=ae(),st=ae(),ot=()=>Ye(ie(rt),"<A> and 'use' router primitives can be only used inside a Route."),at=()=>ot().navigatorFactory();function it(e,t=""){const{component:n,preload:r,load:s,children:o,info:a}=e,f=!o||Array.isArray(o)&&!o.length,h={key:e,component:n,preload:r||s,info:a};return de(e.path).reduce((p,c)=>{for(const i of he(c)){const m=Ze(t,i);let l=f?m:m.split("/*",1)[0];l=l.split("/").map(y=>y.startsWith(":")||y.startsWith("*")?y:encodeURIComponent(y)).join("/"),p.push({...h,originalPath:c,pattern:l,matcher:et(l,!f,e.matchFilters)})}return p},[])}function ct(e,t=0){return{routes:e,score:tt(e[e.length-1])*1e4-t,matcher(n){const r=[];for(let s=e.length-1;s>=0;s--){const o=e[s],a=o.matcher(n);if(!a)return null;r.unshift({...a,route:o})}return r}}}function de(e){return Array.isArray(e)?e:[e]}function ut(e,t="",n=[],r=[]){const s=de(e);for(let o=0,a=s.length;o<a;o++){const f=s[o];if(f&&typeof f=="object"){f.hasOwnProperty("path")||(f.path="");const h=it(f,t);for(const p of h){n.push(p);const c=Array.isArray(f.children)&&f.children.length===0;if(f.children&&!c)ut(f.children,p.pattern,n,r);else{const i=ct([...n],r.length);r.push(i)}n.pop()}}}return n.length?r:r.sort((o,a)=>a.score-o.score)}function D(e,t){for(let n=0,r=e.length;n<r;n++){const s=e[n].matcher(t);if(s)return s}return[]}function lt(e,t){const n=new URL(Ve),r=S(h=>{const p=e();try{return new URL(p,n)}catch{return console.error(`Invalid path ${p}`),h}},n,{equals:(h,p)=>h.href===p.href}),s=S(()=>r().pathname),o=S(()=>r().search,!0),a=S(()=>r().hash),f=()=>"";return{get pathname(){return s()},get search(){return o()},get hash(){return a()},get state(){return t()},get key(){return f()},query:fe(ce(o,()=>le(r())))}}let P;function ft(){return P}let T=!1;function ht(){return T}function Nt(e){T=e}function Kt(e,t,n,r={}){const{signal:[s,o],utils:a={}}=e,f=a.parsePath||(u=>u),h=a.renderPath||(u=>u),p=a.beforeLeave||Je(),c=M("",r.base||"");if(c===void 0)throw new Error(`${c} is not a valid base path`);c&&!s().value&&o({value:c,replace:!0,scroll:!1});const[i,m]=q(!1);let l;const y=(u,g)=>{g.value===d()&&g.state===x()||(l===void 0&&m(!0),P=u,l=g,W(()=>{l===g&&(R(l.value),L(l.state),Ce(),v||X[1]([]))}).finally(()=>{l===g&&Pe(()=>{P=void 0,u==="navigate"&&ve(l),m(!1),l=void 0})}))},[d,R]=q(s().value),[x,L]=q(s().state),k=lt(d,x),_=[],X=q(v?be():[]),Q=S(()=>typeof r.transformUrl=="function"?D(t(),r.transformUrl(k.pathname)):D(t(),k.pathname)),ye=fe(()=>{const u=Q(),g={};for(let b=0;b<u.length;b++)Object.assign(g,u[b].params);return g}),V={pattern:c,path:()=>c,outlet:()=>null,resolvePath(u){return M(c,u)}};return Ee(ce(s,u=>y("native",u),{defer:!0})),{base:V,location:k,params:ye,isRouting:i,renderPath:h,parsePath:f,navigatorFactory:we,matches:Q,beforeLeave:p,preloadRoute:xe,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:X};function Re(u,g,b){Se(()=>{if(typeof g=="number"){g&&(a.go?a.go(g):console.warn("Router integration does not support relative routing"));return}const F=!g||g[0]==="?",{replace:j,resolve:A,scroll:I,state:H}={replace:!1,resolve:!F,scroll:!0,...b},O=A?u.resolvePath(g):M(F&&k.pathname||"",g);if(O===void 0)throw new Error(`Path '${g}' is not a routable path`);if(_.length>=nt)throw new Error("Too many redirects");const Y=d();if(O!==Y||H!==x())if(v){const Z=E();Z&&(Z.response={status:302,headers:new Headers({Location:O})}),o({value:O,replace:j,scroll:I,state:H})}else p.confirm(O,b)&&(_.push({value:Y,replace:j,scroll:I,state:x()}),y("navigate",{value:O,state:H}))})}function we(u){return u=u||ie(st)||V,(g,b)=>Re(u,g,b)}function ve(u){const g=_[0];g&&(o({...u,replace:g.replace,scroll:g.scroll}),_.length=0)}function xe(u,g={}){const b=D(t(),u.pathname),F=P;P="preload";for(let j in b){const{route:A,params:I}=b[j];A.component&&A.component.preload&&A.component.preload();const{preload:H}=A;T=!0,g.preloadData&&H&&oe(n(),()=>H({params:I,location:{pathname:u.pathname,search:u.search,hash:u.hash,query:le(u),state:null,key:""},intent:"preload"})),T=!1}P=F}function be(){const u=E();return u&&u.router&&u.router.submission?[u.router.submission]:[]}}function zt(e,t,n,r){const{base:s,location:o,params:a}=e,{pattern:f,component:h,preload:p}=r().route,c=S(()=>r().path);h&&h.preload&&h.preload(),T=!0;const i=p?p({params:a,location:o,intent:P||"initial"}):void 0;return T=!1,{parent:t,pattern:f,path:c,outlet:()=>h?Ae(h,{params:a,location:o,data:i,get children(){return n()}}):n(),resolvePath(l){return M(s.path(),l,c())}}}const dt="Location",pt=5e3,gt=18e4;let G=new Map;v||setInterval(()=>{const e=Date.now();for(let[t,n]of G.entries())!n[3].count&&e-n[0]>gt&&G.delete(t)},3e5);function J(){if(!v)return G;const e=E();if(!e)throw new Error("Cannot find cache context");return(e.router||(e.router={})).cache||(e.router.cache=new Map)}function pe(e,t){e.GET&&(e=e.GET);const n=(...r)=>{const s=J(),o=ft(),a=ht(),h=se()?at():void 0,p=Date.now(),c=t+ee(r);let i=s.get(c),m;if(v){const d=E();if(d){const R=(d.router||(d.router={})).dataOnly;if(R){const x=d&&(d.router.data||(d.router.data={}));if(x&&c in x)return x[c];if(Array.isArray(R)&&!mt(c,R))return x[c]=void 0,Promise.resolve()}}}if(He()&&!v&&(m=!0,Oe(()=>i[3].count--)),i&&i[0]&&(v||o==="native"||i[3].count||Date.now()-i[0]<pt)){m&&(i[3].count++,i[3][0]()),i[2]==="preload"&&o!=="preload"&&(i[0]=p);let d=i[1];return o!=="preload"&&(d="then"in i[1]?i[1].then(y(!1),y(!0)):y(!1)(i[1]),!v&&o==="navigate"&&W(()=>i[3][1](i[0]))),a&&"then"in d&&d.catch(()=>{}),d}let l=!v&&C.context&&C.has(c)?C.load(c):e(...r);if(i?(i[0]=p,i[1]=l,i[2]=o,!v&&o==="navigate"&&W(()=>i[3][1](i[0]))):(s.set(c,i=[p,l,o,q(p)]),i[3].count=0),m&&(i[3].count++,i[3][0]()),v){const d=E();if(d&&d.router.dataOnly)return d.router.data[c]=l}if(o!=="preload"&&(l="then"in l?l.then(y(!1),y(!0)):y(!1)(l)),a&&"then"in l&&l.catch(()=>{}),v&&C.context&&C.context.async&&!C.context.noHydrate){const d=E();(!d||!d.serverOnly)&&C.context.serialize(c,l)}return l;function y(d){return async R=>{if(R instanceof Response){const x=R.headers.get(dt);if(x!==null){if(h&&x.startsWith("/"))W(()=>{h(x,{replace:!0})});else if(!v)window.location.href=x;else if(v){const L=E();L&&(L.response={status:302,headers:new Headers({Location:x})})}return}R.customBody&&(R=await R.customBody())}if(d)throw R;return R}}};return n.keyFor=(...r)=>t+ee(r),n.key=t,n}pe.set=(e,t)=>{const n=J(),r=Date.now();let s=n.get(e);s?(s[0]=r,s[1]=t,s[2]="preload"):(n.set(e,s=[r,t,,q(r)]),s[3].count=0)};pe.clear=()=>J().clear();function mt(e,t){for(let n of t)if(e.startsWith(n))return!0;return!1}function ee(e){return JSON.stringify(e,(t,n)=>yt(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function yt(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}function Rt(e,t,n){e.context[t]=n}function wt(e){let t;const n=me(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(n,{...r,body:e.node.req.body}):new Request(n,{...r,get body(){return t||(t=At(e),t)}})}function vt(e){return e.web??={request:wt(e),url:me(e)},e.web.request}function xt(){return Tt()}const ge=Symbol("$HTTPEvent");function bt(e){return typeof e=="object"&&(e instanceof K||e?.[ge]instanceof K||e?.__is_event__===!0)}function w(e){return function(...t){let n=t[0];if(bt(n))t[0]=n instanceof K||n.__is_event__?n:n[ge];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(n=xt(),!n)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(n)}return e(...t)}}const me=w(Ue),Et=w(ke),te=w(Te),ne=w(_e),Ct=w(Fe),U=w(We),re=w(Me),Pt=w(Be),St=w(De),Gt=w($e),Jt=w(je),Xt=w(Ie),Qt=w(Le),At=w(Ke),Ht=w(Ne),Vt=w(Rt),Ot=w(vt);function qt(){return ze("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:Ge})}function Tt(){return qt().use().event}const N="solidFetchEvent";function $t(e){return{request:Ot(e),response:_t(e),clientAddress:Et(e),locals:{},nativeEvent:e}}function Lt(e){return{...e}}function Yt(e){if(!e.context[N]){const t=$t(e);e.context[N]=t}return e.context[N]}class kt{event;constructor(t){this.event=t}get(t){const n=re(this.event,t);return Array.isArray(n)?n.join(", "):n||null}has(t){return this.get(t)!==void 0}set(t,n){return Pt(this.event,t,n)}delete(t){return Ht(this.event,t)}append(t,n){St(this.event,t,n)}getSetCookie(){const t=re(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries(U(this.event)).forEach(([n,r])=>t(Array.isArray(r)?r.join(", "):r,n,this))}entries(){return Object.entries(U(this.event)).map(([t,n])=>[t,Array.isArray(n)?n.join(", "):n])[Symbol.iterator]()}keys(){return Object.keys(U(this.event))[Symbol.iterator]()}values(){return Object.values(U(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function _t(e){return{get status(){return ne(e)},set status(t){te(e,t)},get statusText(){return Ct(e)},set statusText(t){te(e,ne(e),t)},headers:new kt(e)}}function Zt(e,t,n){if(typeof e!="function")throw new Error("Export from a 'use server' module must be a function");const r="";return new Proxy(e,{get(s,o,a){return o==="url"?`${r}/_server?id=${encodeURIComponent(t)}&name=${encodeURIComponent(n)}`:o==="GET"?a:s[o]},apply(s,o,a){const f=E();if(!f)throw new Error("Cannot call server function outside of a request");const h=Lt(f);return h.locals.serverFunctionMeta={id:t+"#"+n},h.serverOnly=!0,qe(h,()=>e.apply(o,a))}})}export{rt as R,Kt as a,zt as b,ut as c,st as d,ft as e,ue as f,D as g,Je as h,pe as i,Zt as j,Bt as k,Vt as l,Ve as m,Dt as n,Jt as o,Xt as p,Yt as q,Gt as r,Nt as s,te as t,Qt as u};
